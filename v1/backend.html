<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>TimeonsiteTracker by saleemkce</title>

    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/github-light.css">

    <link rel="stylesheet" href="../stylesheets/custom.css">
    <link rel="stylesheet" href="../stylesheets/sunburst.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
    <body>
        <div class="wrapper">
            <header>
                <h1>TimeonsiteTracker (TOS)</h1>
                <p></p>

                <p class="view"><a href="https://github.com/saleemkce/timeonsite">View the Project on GitHub <small>saleemkce/timeonsite</small></a></p>

                <p><a href="index.html">v1.0.0</a></p>

                <ul>
                  <li><a href="https://github.com/saleemkce/timeonsite/zipball/master">Download <strong>ZIP File</strong></a></li>
                  <li><a href="https://github.com/saleemkce/timeonsite/tarball/master">Download <strong>TAR Ball</strong></a></li>
                  <li><a href="https://github.com/saleemkce/timeonsite">View On <strong>GitHub</strong></a></li>
                </ul>
            </header>
            <section>
            
                <!-- <h3><a id="welcome-to-github-pages" class="anchor" href="#welcome-to-github-pages" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Welcome to GitHub Pages.</h3>

                <p>This automatic page generator is the easiest way to create beautiful pages for all of your projects. Author your page content here <a href="https://guides.github.com/features/mastering-markdown/">using GitHub Flavored Markdown</a>, select a template crafted by a designer, and publish. After your page is generated, you can check out the new <code>gh-pages</code> branch locally. If you’re using GitHub Desktop, simply sync your repository and you’ll see the new branch.</p> -->

                <h3 id="examples">Saving TOS to database - Examples</h3>

                <h3>Server-side data handling</h3>

                <h3>Node.js example</h3>
<pre class="prettyprint lang-js">
//file 1: tos.model.js
var controller = require('tos.controller.js')

module.exports = function(app) {

    app.route('/tos')
        .post(controller.SaveTos);
};



//file 2: tos.model.js
var mongoose = require('mongoose'),
Schema = new mongoose.Schema({
    TOSId: Number,
    TOSSessionKey: String,
    title: String,
    URL: String,
    currentTime: Date,
    entryTime: Date,
    exitTime: Date,
    timeOnPage: Number,
    timeOnPageTrackedBy: String,
    timeOnSite: Number
}, {
    versionKey: false,
    strict: false
});

var TosSchema = mongoose.model('tos', Schema);
module.exports = TosSchema;



//file 3: tos.controller.js
var TosSchema = require('tos.model.js');
var c = 0;
module.exports.SaveTos = function(req, res, next) {
    var data = req.body;
    console.log(data);

    if(data && data.trackingType && data.trackingType == 'tos') {
        var Tos = new TosSchema(data);
        // Data saved to mongoDB's tos collection
        Tos.save(data, function(err){
            console.log(err);
        });

        console.log('TOS type : ' + data.trackingType);
        console.log('Record No : ' + ++c);
    } else {
        console.log('TOS data not received. Please check your endpoint URL and POST data from client-side!');
    }

    res.send('success');
    
};
</pre>
<p>
The example uses node's express framework to handle server-side data. We have three files here for saving data with node.js. A route file, a model file and a controller file.<br/><br/>
* In route file, we create a route called "/tos" which is of POST method to accept data from incoming requests.
<br/><br/>
* In model file, we create new shema named "tos" which will save our TOS data. Since mongoDB is schema-free, we can save any number of fields in its collection. This is preferrable for collecting large number of custom data in TOS over RDBMS like MSSQL, MySql or Oracle.
<br/><br/>
* In controller file, we just check if there is data in "SaveTos" method. Then we load schema file and save our TOS data. By now, you might check your mongoDB collection to see if there is any data saved successfully.
</p>


<h3>PHP example</h3>
<pre class="prettyprint lang-sql">
<xmp>
// Create database named "test". Then, create table in any RDBMS (this example was checked in mysql DB)

CREATE TABLE tos(id INT AUTO_INCREMENT,
    tos_id INT,
    tos_session_key VARCHAR(50),
    url VARCHAR(10000),
    title VARCHAR(5000),
    entry_time datetime,
    exit_time datetime,
    timeonpage INT,
    timeonpage_tracked_by VARCHAR(15),
    timeonsite INT,
    trackingtype VARCHAR(15),
    realtime_tracking BOOLEAN NOT NULL DEFAULT 0,
    transferred_with VARCHAR(15) NULL,
    PRIMARY KEY ( id )) CHARACTER SET utf8 COLLATE utf8_general_ci


//In PHP, file: tos.php
<?php
if($_SERVER['REQUEST_METHOD'] == 'POST') {

    $data = json_decode(file_get_contents("php://input"));
    //print_r($data);

    // Mysql DB credentials
    $host = "localhost";
    $user = "root";
    $password = "";
    $database = "test";

    $con = mysqli_connect($host, $user, $password, $database);
    // Check connection
    if (mysqli_connect_errno())
    {
        echo "Failed to connect to MySQL: " . mysqli_connect_error();
    }

    // Perform queries
    $qry = "INSERT INTO tos (tos_id, tos_session_key, url, title, entry_time, exit_time, timeonpage, timeonpage_tracked_by, timeonsite, trackingtype, realtime_tracking, transferred_with) VALUES (".$data->TOSId.", '".$data->TOSSessionKey."', '".$data->URL."', '".$data->title."', '".$data->entryTime."', '".$data->exitTime."', ".$data->timeOnPage.", '".$data->timeOnPageTrackedBy."', ".$data->timeOnSite.", '".$data->trackingType."', ".$data->realTimeTracking.", '".$data->trasferredWith."')";
    //echo $qry;
    $res = mysqli_query($con, $qry);

    mysqli_close($con);
    if($res) {
        echo 'success';
    } else {
        echo json_encode($res);
    }
} else {
    echo 'No data received!';
}
</xmp>
</pre>

<p>
* We form the required SQL query for saving our data in MySql or any other RDBMS of your preference. Create a database named "test". Then execute the given query to create new table called "tos".<br/><br/>
* Create a new file named "tos.php" which checks if there is any incoming request with POST data. In case of valid data, it saves the data to "tos" table in database we just created. Don't forget to restart your server (Apache, nginx etc.) that runs PHP.
</p>

            </section>
            <footer>
                <p>This project is maintained by <a href="https://github.com/saleemkce">saleemkce</a></p>
                <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
            </footer>
        </div>
        <script src="../javascripts/scale.fix.js"></script>
        <script src="../javascripts/run_prettify.js"></script>
        
    </body>
</html>
<!-- 
html code conversion @
http://www.web2generators.com/html-based-tools/online-html-entities-encoder-and-decoder 
-->





